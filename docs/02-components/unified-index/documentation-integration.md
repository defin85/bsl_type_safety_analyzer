# Интеграция документации 1С в BSL Type Safety Analyzer

## Обзор

BSL Type Safety Analyzer теперь включает полную интеграцию с документацией 1С:Enterprise через парсинг архивов справки (.hbk файлы). Это позволяет:

- ✅ Верифицировать вызовы методов с правильным количеством параметров
- ✅ Предоставлять автодополнение с документацией
- ✅ Показывать подсказки при наведении (hover) в LSP
- ✅ Искать методы и объекты по имени

## Архитектура

### 1. Парсер HBK архивов (`hbk_parser_full.rs`)
- Полный порт Python парсера из проекта `1c-help-parser`
- Читает .hbk файлы как ZIP архивы
- Извлекает HTML документацию
- Парсит структурированную информацию

### 2. Экстрактор синтаксиса BSL (`bsl_syntax_extractor.rs`)
- Анализирует HTML файлы документации
- Категоризирует элементы: objects, methods, properties, functions, operators
- Извлекает метаданные: параметры, возвращаемые значения, примеры

### 3. Chunked Writer (`chunked_writer.rs`)
- Разбивает большие объемы данных на файлы по 50KB / 50 элементов
- Создает структуру идентичную эталонной из проекта Unicom
- Генерирует индексные файлы для быстрого поиска

### 4. Chunked Loader (`chunked_loader.rs`)
- Эффективно загружает документацию из разбитых файлов
- Поддерживает поиск по ID и имени объекта
- Кэширует индексы для быстрого доступа

### 5. Фасад DocsIntegration (`mod.rs`)
- Единая точка входа для работы с документацией
- Поддерживает загрузку из:
  - HBK архивов напрямую
  - Единого JSON файла
  - Chunked формата (рекомендуется)

## Использование

### Генерация документации из HBK архива

```bash
# 1. Подготовка архива (требуется WinRAR)
# Восстановите .hbk файл в .zip формат

# 2. Генерация chunked документации
cargo run --release --bin process_all_docs

# 3. Улучшение индекса (добавление объектного маппинга)
cargo run --release --bin enhance_index output/docs_search
```

### Использование в коде

```rust
use bsl_analyzer::docs_integration::DocsIntegration;

// Создаем интеграцию
let mut docs = DocsIntegration::new();

// Загружаем из chunked формата (быстро)
docs.load_chunked_documentation("output/docs_search")?;

// Используем для верификации
if let Some(method) = docs.get_method_info("Сообщить") {
    println!("Параметры: {} обязательных", method.required_params_count);
}

// Автодополнение
let completions = docs.get_completions("Масс");

// Поиск методов
let methods = docs.search_methods("Добавить");
```

## Структура выходных файлов

```
docs_search/
├── main_index.json          # Главный индекс с улучшенной статистикой
├── objects/                 # Объекты BSL
│   ├── objects_001.json
│   ├── objects_002.json
│   └── objects_index.json
├── methods/                 # Методы объектов
│   ├── methods_001.json
│   └── methods_index.json
├── properties/              # Свойства объектов
├── functions/               # Глобальные функции
└── operators/               # Операторы языка
```

## Улучшенный main_index.json

Теперь включает:
- **item_index** - прямое сопоставление ID элемента с объектом
- **statistics** - расширенная статистика обработки
- **version_info** - информация о версиях

Пример записи в item_index:
```json
"methods_0": {
  "category": "methods",
  "file": "methods_001.json",
  "object_name": "ДинамическийСписок",
  "title": "ДинамическийСписок.АвтоЗаполнениеДоступныхПолей"
}
```

## Производительность

- Парсинг 24,979 HTML файлов: **~7.5 секунд**
- Размер выходных данных: **33.85 MB** в 609 файлах
- Среднее количество элементов на файл: **41**

## Отдельные утилиты

1. **test_hbk_parser** - тестирование парсера HBK архивов
2. **test_chunked_export** - тестовый экспорт 100 файлов
3. **process_all_docs** - полная обработка всех файлов
4. **enhance_index** - улучшение main_index.json

## Интеграция с анализатором

Документация интегрирована в основную библиотеку и может использоваться:
- В CLI анализаторе для улучшенной верификации
- В LSP сервере для автодополнения и подсказок
- В отдельных инструментах для поиска и анализа

## Пример полной интеграции

См. `examples/analyzer_with_docs.rs` для примера использования анализатора вместе с загруженной документацией.